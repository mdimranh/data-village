<div class="p-4 container mx-auto" id="folders">
    {% if files %}
    <div id="add-file" data-modal-backdrop="static" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative w-full max-w-lg max-h-full">
            <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                <h1 class="font-bold text-lg text-slate-600 p-4">Add New File</h1>
                <div class="p-4 md:p-5">
                    {% include "dashboard/data/forms/add-file.html" %}
                </div>
            </div>
        </div>
    </div>
    <div class="py-6 px-6 bg-white rounded drop-shadow">
        {% include "dashboard/data/file_list.html" %}
    </div>
    {% elif folders %}
    <div id="add-folder" data-modal-backdrop="static" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative w-full max-w-lg max-h-full">
            <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                <h1 class="font-bold text-lg text-slate-600 p-4">Add New Folder</h1>
                <div class="p-4 md:p-5">
                    {% include "dashboard/data/forms/add-folder.html" %}
                </div>
            </div>
        </div>
    </div>
    <div class="py-6 px-6 bg-white rounded drop-shadow">
        {% include "dashboard/data/folder_grid.html" %}
    </div>
    {% else %}
        <div id="add-folder" data-modal-backdrop="static" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
            <div class="relative w-full max-w-lg max-h-full">
                <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                    <h1 class="font-bold text-lg text-slate-600 p-4">Add New Folder</h1>
                    <div class="p-4 md:p-5">
                        {% include "dashboard/data/forms/add-folder.html" %}
                    </div>
                </div>
            </div>
        </div>
        <div class="flex flex-col w-full items-center bg-white">
            <div class="overflow-hidden dark:border-gray-700 md:rounded-lg">
                <div class="w-full text-center mx-auto">
                    <img class="w-32 h-32 mx-auto"
                    src="https://res.cloudinary.com/daqsjyrgg/image/upload/v1690261234/di7tvpnzsesyo7vvsrq4.svg"
                    alt="image empty states">
                    <p class="text-gray-700 font-medium text-lg text-center">No folder available.</p>
                    <p class="text-gray-500 text-center">You can add new folder to display in this section.</p>
                    <button data-modal-target="add-folder" data-modal-toggle="add-folder"
                    class="flex items-center px-4 py-1.5 border border-gray-400 mt-4 rounded text-sm bg-blue-500 hover:bg-blue-600 text-white mx-auto mb-8">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-6 h-6  mr-2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Add New Folder
                    </button>
                </div>
            </div>
        </div>
        {% if not parent %}
            <div id="add-file" data-modal-backdrop="static" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
                <div class="relative w-full max-w-lg max-h-full">
                    <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                        <h1 class="font-bold text-lg text-slate-600 p-4">Add New File</h1>
                        <div class="p-4 md:p-5">
                            {% include "dashboard/data/forms/add-file.html" %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex flex-col w-full items-center bg-white mt-3">
                <div class="overflow-hidden dark:border-gray-700 md:rounded-lg">
                <div class="w-full text-center mx-auto">
                    <img class="w-32 h-32 mx-auto"
                    src="https://cdn-icons-png.flaticon.com/512/6598/6598519.png"
                    alt="image empty states">
                    <p class="text-gray-700 font-medium text-lg text-center">No file available.</p>
                    <p class="text-gray-500 text-center">You can add new file to display in this section.</p>
                    <button id="add-file-button" data-modal-target="add-file" data-modal-toggle="add-file"
                    class="flex items-center px-4 py-1.5 border border-gray-400 mt-4 rounded text-sm bg-blue-500 hover:bg-blue-600 text-white mx-auto mb-8">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-6 h-6  mr-2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Add New File
                    </button>
                </div>
            </div>
        {% endif %}
        </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener("htmx:confirm", function(e) {
        if(e.detail.verb === "delete"){
            e.preventDefault();
            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "Yes, delete it!",
                }).then((result) => {
                if (result.isConfirmed) {
                    e.detail.issueRequest(true)
                    // dont close the swal. start loading after response show message
                }
            });
        }
    });
    
    {% comment %} document.addEventListener("htmx:beforeSend", function(event) {
        console.log("Before send")
        Swal.showLoading(); // Show loading spinner on every htmx request
    }); {% endcomment %}

    document.addEventListener("htmx:afterSwap", function(event) {
        if(event.detail.requestConfig.verb === "post"){
            $('[modal-backdrop]').remove();
            var successMessage = "File added successfully";
            Swal.fire({
                toast: true,
                icon: 'success',
                title: successMessage,
                animation: false,
                position: 'bottom-right',
                showConfirmButton: false,
                timer: 5000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })
        }
        if(event.detail.requestConfig.verb === "delete"){
            var successMessage = "File deleted successfully";
            Swal.fire({
                toast: true,
                icon: 'success',
                title: successMessage,
                animation: false,
                position: 'bottom-right',
                showConfirmButton: false,
                timer: 5000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })
        }
    });
    document.addEventListener("htmx:responseError", function(event) {
        if(event.detail.requestConfig.verb == "delete"){
            var errorMessage = "Failed to delete";
            Swal.fire({
                title: "Failed",
                text: errorMessage,
                icon: "error"
            });
        }
    });
    
    document.addEventListener('DOMContentLoaded', function() {
        var deleteButtons = document.querySelectorAll('.delete-button');
        var editButtons = document.querySelectorAll('.edit-button');
        deleteButtons.forEach(function(deleteButton) {
            deleteButton.addEventListener('click', function(event) {
                event.preventDefault();
                event.stopPropagation();
            });
        })
        
        editButtons.forEach(function(editButton) {
            editButton.addEventListener('click', function(event) {
                event.preventDefault();
                event.stopPropagation();
            });
        })
    });
</script>